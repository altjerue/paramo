module K2
   use data_types
   implicit none
   real(dp) :: xmin, xmax, oxxm, mxxm
   real(dp), dimension(120) :: Ftab
   public

contains

   function K2_func(x) result(res)
      implicit none
      real(dp), intent(in) :: x
      real(dp) :: res, d, dd, y, y2, sv
      integer :: i
      d = 0
      dd = 0d0
      y = (2d0 * x + mxxm) * oxxm
      y2 = 2d0 * y
      do i = 120, 2, -1
         sv = d
         d = y2 * d - dd + Ftab(i)
         dd = sv
      enddo
      res = y * d - dd + 5d-1 * Ftab(1)
   end function K2_func

   subroutine K2_init
      implicit none
      xmin = -8d0
      xmax =  5d0
      oxxm = 1d0 / (xmax - xmin)
      mxxm = - xmin - xmax
      Ftab = (/ -36.06634422844878d0, &
         -53.372857024015055d0, &
         -32.35629265989789d0, &
         -22.31758870210901d0, &
         -13.209679615272847d0, &
         -6.7015257112969815d0, &
         -2.9332498716543247d0, &
         -1.1369173962321883d0, &
         -0.41129215190071833d0, &
         -0.1443151328987372d0, &
         -0.045584228754296525d0, &
         -0.010087622083393413d0, &
         -0.0008879235450883627d0, &
         -0.0004737635097959725d0, &
         -0.0007796569324356995d0, &
         -0.00029463377511540045d0, &
         0.00014088469336947184d0, &
         0.00014019803434624833d0, &
         -0.000010759901931116645d0, &
         -0.00005580126509975969d0, &
         -0.000013370729916424295d0, &
         0.00001684434065293061d0, &
         0.00001032409960316727d0, &
         -3.185832847876213d-6, &
         -4.9508995120817194d-6, &
         -3.309354746861004d-7, &
         1.8066340787470381d-6, &
         6.977516624218083d-7, &
         -4.817944575563615d-7, &
         -4.243001664505641d-7, &
         5.401333780241657d-8, &
         1.8339504499920168d-7, &
         3.696611241110759d-8, &
         -6.046074641830046d-8, &
         -3.380238009498271d-8, &
         1.314277330521918d-8, &
         1.75696618853749d-8, &
         3.8626975396027775d-10, &
         -6.856561327595045d-9, &
         -2.341912743730745d-9, &
         1.9838435783015028d-9, &
         1.5682535270400422d-9, &
         -2.909824026176011d-10, &
         -7.202761942437519d-10, &
         -1.1406296351879064d-10, &
         2.5216371213332426d-10, &
         1.2656757419904353d-10, &
         -6.069820202014853d-11, &
         -7.034959281781994d-11, &
         1.8464341167145904d-12, &
         2.892074135729672d-11, &
         8.542340168560258d-12, &
         -8.92269369501264d-12, &
         -6.3158367424875905d-12, &
         1.5726442370578298d-12, &
         3.0582825161218354d-12, &
         3.4702907214523296d-13, &
         -1.127702375924855d-12, &
         -5.040412531798211d-13, &
         2.9489299890883556d-13, &
         2.999378523327323d-13, &
         -2.135180920959101d-14, &
         -1.270095140171179d-13, &
         -3.172573315168847d-14, &
         4.1442405063207847d-14, &
         2.616573624436569d-14, &
         -9.237055564881303d-15, &
         -1.3109513474773848d-14, &
         5.329070518200751d-17, &
         7.30082660993503d-15, &
         4.103384299014579d-15, &
         1.900701818158268d-15, &
         1.0835776720341528d-15, &
         1.438849039914203d-15, &
         2.0072832285222832d-15, &
         2.6645352591003756d-16, &
         3.019806626980426d-16, &
         3.552713678800501d-17, &
         1.4210854715202005d-15, &
         5.684341886080802d-16, &
         8.348877145181178d-16, &
         8.526512829121202d-16, &
         4.973799150320702d-16, &
         5.151434834260726d-16, &
         8.526512829121202d-16, &
         2.3625545964023332d-15, &
         2.149391775674303d-15, &
         3.3573144264664736d-15, &
         3.765876499528531d-15, &
         3.570477247194504d-15, &
         2.3092638912203257d-15, &
         1.1368683772161603d-15, &
         7.105427357601002d-16, &
         6.217248937900877d-16, &
         -1.7763568394002505d-17, &
         5.861977570020827d-16, &
         7.638334409421077d-16, &
         4.440892098500626d-16, &
         1.8118839761882555d-15, &
         1.1901590823981679d-15, &
         1.3855583347321954d-15, &
         7.105427357601002d-16, &
         6.394884621840901d-16, &
         4.973799150320702d-16, &
         2.486899575160351d-16, &
         2.1316282072803005d-16, &
         3.552713678800501d-17, &
         8.526512829121202d-16, &
         -7.993605777301127d-16, &
         -5.506706202140776d-16, &
         -1.2789769243681803d-15, &
         -1.3145040611561853d-15, &
         -9.059419880941278d-16, &
         -3.730349362740526d-16, &
         -1.5987211554602254d-16, &
         -1.7763568394002506d-16, &
         7.638334409421077d-16, &
         3.552713678800501d-17, &
         2.3092638912203257d-16, &
         -7.105427357601002d-16 &
         /)
   end subroutine K2_init

end module K2
