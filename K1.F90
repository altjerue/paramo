module K1
   use data_types
   implicit none
   real(dp) :: xmin, xmax, oxxm, mxxm
   real(dp), dimension(120) :: Ftab
   public

contains

   function K1_func(x) result(res)
      implicit none
      real(dp), intent(in) :: x
      real(dp) :: res, d, dd, y, y2, sv, dpi
      integer :: i
      dpi = 3.1415926535897932385d0
      d = 0
      dd = 0d0
      y = (2d0 * x + mxxm) * oxxm
      y2 = 2d0 * y
      if (x .gt. xmax) then
         res = 5d-1 * (dlog(5d-1 * dpi) - x) - dexp(x)
      else if (x .lt. xmin) then
         res = - x
      else
         do i = 120, 2, -1
            sv = d
            d = y2 * d - dd + Ftab(i)
            dd = sv
         enddo
         res = y * d - dd + 5d-1 * Ftab(1)
      end if
   end function K1_func

   subroutine K1_init
      implicit none
      xmin = -6.907755278982137
      xmax = 4.605170185988092
      oxxm = 1d0 / (xmax - xmin)
      mxxm = - xmin - xmax
      Ftab = (/ -30.160962770934198d0, &
         -35.47187743753279d0, &
         -22.802842864466093d0, &
         -14.700255116452128d0, &
         -8.001119833200908d0, &
         -3.716468586483768d0, &
         -1.5031620402435166d0, &
         -0.5446334327310914d0, &
         -0.18037091114805084d0, &
         -0.05377607558904317d0, &
         -0.013809106373865329d0, &
         -0.0031482032422764485d0, &
         -0.0008356673255545655d0, &
         -0.00026061853715567904d0, &
         -0.000034605028276706306d0, &
         0.000017403954791079813d0, &
         2.1814094970018516d-6, &
         -5.933983877985938d-6, &
         -1.6118783077878617d-6, &
         1.3080256820341418d-6, &
         5.833653890530144d-7, &
         -2.7285625666451095d-7, &
         -1.8926449351752695d-7, &
         4.8522511475468376d-8, &
         5.649484092096202d-8, &
         -5.841961012720276d-9, &
         -1.58392645310812d-8, &
         -4.143756626717732d-10, &
         4.203096910515569d-9, &
         6.340590719133843d-10, &
         -1.0555681662083317d-9, &
         -3.021094041599781d-10, &
         2.4880710824959353d-10, &
         1.1276380718072688d-10, &
         -5.38404609784493d-11, &
         -3.739789811163519d-11, &
         1.0108758274895991d-11, &
         1.1484431183816923d-11, &
         -1.3604051218862879d-12, &
         -3.3262015364243782d-12, &
         -3.777422818984633d-14, &
         9.110934229283884d-13, &
         1.226130308396023d-13, &
         -2.364419771083703d-13, &
         -6.288303211476886d-14, &
         5.726974450226408d-14, &
         2.3936408410918374d-14, &
         -1.311839525897085d-14, &
         -9.681144774731365d-15, &
         1.794120407794253d-15, &
         1.5454304502782179d-15, &
         -1.4654943925052068d-15, &
         -1.5543122344752192d-15, &
         -1.0658141036401502d-15, &
         -6.128431095930865d-16, &
         -3.375077994860476d-16, &
         -1.687538997430238d-16, &
         -1.1546319456101628d-16, &
         8.704148513061227d-16, &
         3.4638958368304885d-16, &
         4.884981308350689d-16, &
         1.509903313490213d-16, &
         1.687538997430238d-16, &
         -1.0658141036401502d-16, &
         2.575717417130363d-16, &
         7.01660951563099d-16, &
         1.056932319443149d-15, &
         1.3766765505351941d-15, &
         1.2967404927621828d-15, &
         1.1457501614131616d-15, &
         1.0214051826551441d-15, &
         9.681144774731366d-16, &
         0.0d0, &
         2.6645352591003756d-16, &
         7.01660951563099d-16, &
         7.993605777301127d-16, &
         6.927791673660977d-16, &
         1.092459456231154d-15, &
         1.7053025658242404d-15, &
         7.194245199571015d-16, &
         7.815970093361102d-16, &
         5.329070518200751d-16, &
         5.595524044110789d-16, &
         4.3520742565306136d-16, &
         2.9309887850104134d-16, &
         2.3980817331903383d-16, &
         -8.881784197001253d-17, &
         2.6645352591003756d-16, &
         -5.861977570020827d-16, &
         -1.0480505352461477d-15, &
         -8.171241461241152d-16, &
         -1.6253665080512292d-15, &
         -1.403321903126198d-15, &
         -1.0125233984581429d-15, &
         -1.0391687510491465d-15, &
         4.4408920985006264d-17, &
         4.263256414560601d-16, &
         9.237055564881303d-16, &
         1.2079226507921704d-15, &
         8.43769498715119d-16, &
         6.039613253960852d-16, &
         8.704148513061227d-16, &
         9.592326932761353d-16, &
         1.1546319456101628d-15, &
         6.572520305780927d-16, &
         9.769962616701378d-16, &
         9.85878045867139d-16, &
         2.842170943040401d-16, &
         -1.0746958878371515d-15, &
         -1.127986593019159d-15, &
         -1.3677947663381929d-15, &
         -1.1812772982011666d-15, &
         -4.3520742565306136d-16, &
         -2.842170943040401d-16, &
         2.220446049250313d-16, &
         8.08242361927114d-16, &
         1.2878587085651815d-15, &
         1.7497114868092467d-15, &
         1.8207657603852566d-15, &
         1.0125233984581429d-15 &
         /)
   end subroutine K1_init

end module K1
